This is a good stopping point for today. I haven't tested this much but I think I got the changes you want. Let me know!