The code you gave is just a volume based MACD. It is not volume weighted because it doesnt take into account any price data other than volume. You can see in the image that open, high, low or close, is not mentioned anywhere. So its not a volume weighted MACD.It is a volume MACD.If thats what you want im happy to change it, but just thought you should know its not what it says it is.