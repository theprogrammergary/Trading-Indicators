Okay that code you sent above looks to be correct.

This is what you sent earlier and what I based the first TOS version on